<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Add this line to the <head> section of your HTML file -->
    <link rel="stylesheet" href="../bootstrap-5.3.2-dist/css/bootstrap.css">
    <!-- Local bootstrap.js-->
    <script src="../bootstrap-5.3.2-dist/js/bootstrap.js"></script>
    <!-- Vector library for car painting UI-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script> 

    <!-- Global bootstrap js-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

        <div class="container text-white mt-5 bg-light mx-80 " style="display: flex; justify-content: space-between; ">
            <div>
                <h2 class="mt-3">Select Car Areas to Paint</h2>
                <div  class="mt-3 bg-dark" id="imageContainer">
                    <img class="mt-3"src="../images/car_template.png" alt="Your Image" id="carImage" usemap="#image-map" />
                    <canvas class="mt-3"id="overlayCanvas"></canvas>
                    <map name="image-map" id="image-map">
                    <area tag="area" class="pointer-cursor" alt="Hood" title="Hood" coords="128,172,250,172,243,199,243,215,241,236,243,256,241,275,242,297,250,327,229,326,198,327,162,327,128,325,126,304,124,287,120,279,120,236,121,221,126,199" shape="poly" onclick="toggleOverlay(0)">
                    <area tag="area" class="pointer-cursor" alt="Roof" title="Roof"  coords="304,251,302,209,306,189,329,190,345,190,397,191,417,190,436,190,453,190,448,213,448,233,446,263,448,286,451,313,403,310,362,309,323,311,307,311,304,289" shape="poly" onclick="toggleOverlay(1)">
                    <area tag="area" class="pointer-cursor" alt="Trunk" title="Trunk" coords="589,252,588,206,582,174,538,174,517,175,467,185,454,189,448,214,446,253,446,283,453,313,494,317,520,326,539,329,582,327,590,295,520,314,503,313,474,309,457,302,453,281,453,258,453,234,456,209,457,198,469,192,490,187,504,185,521,187,525,187,524,210,526,251,526,281,525,312,589,296"  shape="poly" onclick="toggleOverlay(2)">
                    <area tag="area" class="pointer-cursor" alt="Door1" title="Door1" coords="370,351,345,350,320,354,308,358,291,367,278,374,269,380,257,386,247,395,246,414,243,430,244,449,247,459,250,472,261,475,275,475,292,475,314,474,327,474,346,476,370,475,365,453,363,428,364,410,365,400,362,355,364,374,362,388,360,394,340,394,322,395,304,396,282,396,260,395,266,388,280,380,296,371,317,359,344,356,352,355,364,357,363,416"   shape="poly" onclick="toggleOverlay(3)">
                    <area tag="area" class="pointer-cursor" alt="Door2" title="Door2" coords="433,472,441,448,452,433,473,420,476,415,471,400,464,387,450,372,438,360,434,353,420,351,407,351,393,351,382,351,370,351,367,371,367,395,365,415,364,437,367,455,370,474,404,472,373,395,374,375,373,357,388,355,401,355,410,356,418,357,425,357,430,362,440,368,448,377,455,386,458,394,448,395,437,395,421,395,410,396,391,395,372,394,373,474,424,476"  shape="poly" onclick="toggleOverlay(4)">
                    <area tag="area" class="pointer-cursor" alt="Door3" title="Door3" coords="252,25,279,25,298,24,341,24,368,25,364,52,364,87,368,127,370,148,349,150,325,147,306,141,282,127,264,114,250,106,243,74,245,44,258,103,270,111,280,119,290,124,299,129,314,137,329,143,348,143,365,143,362,125,362,111,361,104,346,103,328,103,309,103,290,103,269,102,258,103,242,49" shape="poly" onclick="toggleOverlay(5)">
                    <area tag="area" class="pointer-cursor" alt="Door4" title="Door4" coords="368,25,392,25,419,25,434,25,437,42,445,58,453,65,464,74,475,81,473,93,466,103,456,118,450,126,441,137,430,145,419,148,408,149,389,149,369,148,368,124,367,103,362,78,364,61,365,44,376,143,397,142,411,142,427,141,440,129,451,117,458,104,442,105,425,103,408,104,393,104,373,104,365,60"  shape="poly" onclick="toggleOverlay(6)">
                    <area tag="area" class="pointer-cursor" alt="Back_Left" title="Back_Left"  coords="434,474,442,474,449,454,456,441,469,435,483,431,498,433,509,444,517,459,522,470,526,475,540,476,569,475,576,463,585,458,584,438,576,436,568,435,567,423,568,413,581,414,582,406,573,401,561,398,546,393,530,390,522,385,515,382,503,377,495,371,482,366,469,361,458,357,446,355,434,355,445,359,461,363,474,368,486,373,496,378,504,383,515,390,527,395,510,395,494,395,479,395,469,385,461,377,447,363,435,355,447,371,459,382,464,392,472,402,477,411,473,420,458,430,447,439" shape="poly" onclick="toggleOverlay(7)">
                    <area tag="area" class="pointer-cursor" alt="Back_Right" title="Back_Right"coords="433,26,445,25,447,41,458,58,471,66,485,70,498,64,506,58,517,49,520,40,520,30,525,26,568,24,575,32,578,41,586,43,584,55,581,62,569,65,568,70,570,86,581,84,583,93,575,96,568,99,554,102,543,107,527,111,517,116,502,123,492,129,480,136,465,141,450,144,432,145,446,140,458,137,469,132,482,127,497,120,510,113,527,104,504,103,480,103,469,114,453,129,447,137,434,145,440,136,447,128,454,120,460,112,469,101,474,92,476,82,469,74,459,69,448,59,443,51" shape="poly" onclick="toggleOverlay(8)">
                    <area tag="area" class="pointer-cursor" alt="Front_Right" title="Front_Right" coords="250,24,234,25,232,42,219,60,208,67,187,67,170,60,157,39,154,24,128,25,119,39,110,46,112,63,125,64,137,64,144,83,127,84,148,93,165,98,195,98,213,100,232,102,242,104,248,107,244,88,244,75,242,56" shape="poly" onclick="toggleOverlay(9)">
                    <area tag="area" class="pointer-cursor" alt="Front_Left" title="Front_Left" coords="197,431,218,437,230,451,237,476,253,475,245,457,245,433,244,417,248,394,230,395,207,401,193,399,169,404,136,410,128,414,144,418,138,435,114,435,110,448,112,459,120,460,127,475,154,474,157,456,169,440,182,433"  shape="poly" onclick="toggleOverlay(10)">
                    <area tag="area" class="pointer-cursor" alt="Back_Bumper" title="Back_Bumper"  coords="667,248,666,168,652,163,651,159,642,157,639,163,637,197,610,198,611,303,640,304,637,336,642,340,650,340,653,336,659,334,667,328" shape="poly" onclick="toggleOverlay(11)">
                    <area tag="area" class="pointer-cursor" alt="Front_Bumper" title="Front_Bumper" coords="18,199,18,171,26,164,32,162,38,157,45,160,48,162,60,163,70,167,69,183,69,209,64,214,64,282,69,289,69,310,69,333,57,336,50,336,42,342,36,338,24,334,19,325,21,260,18,236" shape="polygon" onclick="toggleOverlay(12)">
                </map>
            </div>
            <button id="select-all-button" class="btn btn-outline-secondary text-white mt-2" onclick="ActivateAllOverlays()">Select All</button>
            <button id="select-all-button" class="btn  btn-outline-secondary text-white mt-2" onclick="DeactivateAllOverlays()">Deselect All</button>
            <p>Estimated Price: $<span id="price">0.00</span></p>
        </div>

        <div class="text-white mt-3" style="flex: 1; margin-left: 10%;">
            <h2>Choose services</h2>
            <form id="repairForm" class="mt-3">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="OverallCheckup" value="150" onchange="calculatePrice()">
                <label class="form-check-label" for="OverallCheckup">Overall Checkup - $<span id="CheckupCost">150.00</span></label>
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="RustRemoval" value="500" onchange="calculatePrice()">
                <label class="form-check-label" for="RustRemoval">Rust Removal - $<span id="RustRemovalCost">500.00</span></label>
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="Tuning" value="1500" onchange="calculatePrice()">
                <label class="form-check-label" for="Tuning">Tuning - $<span id="TuningCost">1500.00</span></label>
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="CustomPartInsertion" value="150" onchange="calculatePrice()">
                <label class="form-check-label" for="CustomPartInsertion">Custom Part Insertion - $<span id="CustomPartInsertionCost">150.00</span></label>
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="Pricing" value="0" onchange="calculatePrice()">
                <label class="form-check-label" for="Pricing">Paint job - $<span id="paintPrice">0.00</span></label>
            </div>
        </form>
        <p id="totalPrice" class="mt-4 ">Estimated Price: $0.00</p>
    </div>
</div>
</div>



<script>
    const flags = []; // Array of flags for each coordinate set
    const overlayPrices = [50, 50, 50, 75, 75, 75, 75, 100, 100, 100, 100, 50, 50];
    let activeOverlayIndex = -1; // Index of the currently active overlay

    function createRedOverlayPolygons() {
        // Get the map image element
        const mapImage = document.getElementById('carImage');
    
        const canvas = document.getElementById('overlayCanvas');
        const ctx = canvas.getContext('2d');
    
        // Set canvas size to match the map image size
        canvas.width = mapImage.width;
        canvas.height = mapImage.height;
    
        const coordinates = [
            "128,172,250,172,243,199,243,215,241,236,243,256,241,275,242,297,250,327,229,326,198,327,162,327,128,325,126,304,124,287,120,279,120,236,121,221,126,199" , // Hood
            "302,287,304,259,303,215,308,188,341,190,374,192,432,189,454,189,448,205,447,253,446,280,451,312,405,309,366,309,339,309,317,311,305,310,304,296,303,291,338,289,360,288,370,281,371,224,362,214,339,211,327,220,326,242,325,267,329,282,335,290,306,314" , // Roof
            "589,252,588,206,582,174,538,174,517,175,467,185,454,189,448,214,446,253,446,283,453,313,493,320,520,326,539,329,582,327,590,295,520,314,503,313,474,309,457,302,453,281,453,258,453,234,456,209,457,198,469,192,490,187,504,185,521,187,525,187,524,210,526,251,526,281,525,315,589,296", //Trunk
            "370,351,345,350,320,354,308,358,291,367,278,374,269,380,257,386,247,395,246,414,243,430,244,449,247,459,250,472,261,475,275,475,292,475,314,474,327,474,346,476,370,475,365,453,363,428,364,410,365,400,362,355,364,374,362,388,360,394,340,394,322,395,304,396,282,396,260,395,266,388,280,380,296,371,317,359,344,356,352,355,364,357,363,416"  , // Door1
            "433,472,441,448,452,433,473,420,476,415,471,400,464,387,450,372,438,360,434,353,420,351,407,351,393,351,382,351,370,351,367,371,367,395,365,415,364,437,367,455,370,474,404,472,373,395,374,375,373,357,388,355,401,355,410,356,418,357,425,357,430,362,440,368,448,377,455,386,458,394,448,395,437,395,421,395,410,396,391,395,372,394,373,474,424,476" , //Door2
            "252,25,279,25,298,24,341,24,368,25,364,52,364,87,368,127,370,148,349,150,325,147,306,141,282,127,264,114,250,106,243,74,245,44,258,103,270,111,280,119,290,124,299,129,314,137,329,143,348,143,365,143,362,125,362,111,361,104,346,103,328,103,309,103,290,103,269,102,258,103,242,49", //Door3
            "368,25,392,25,419,25,434,25,437,42,445,58,453,65,464,74,475,81,474,93,469,106,458,119,450,126,441,137,430,145,419,148,408,149,389,149,369,148,368,124,367,103,362,78,364,61,365,44,376,143,397,142,411,142,427,141,440,129,451,117,458,104,442,105,425,103,408,104,393,104,373,104,364,92" , //Door4
            "434,474,442,474,448,457,457,443,471,434,483,431,498,433,509,444,517,459,522,470,526,475,540,476,573,473,576,463,585,458,584,438,576,436,568,435,567,423,568,413,581,414,582,406,573,401,561,398,546,393,530,390,522,385,515,382,503,377,495,371,482,366,469,361,458,357,433,354,434,355,445,360,461,363,474,368,486,373,496,378,504,383,515,390,527,395,510,395,494,395,479,395,469,385,461,377,454,369,435,355,453,376,459,382,464,392,472,402,477,411,473,420,458,430,447,439", // Back Left
            "433,26,445,25,447,41,458,58,471,66,485,70,498,64,506,58,517,49,520,40,520,30,525,26,568,24,575,32,578,41,586,43,584,55,581,62,569,65,568,70,570,86,581,84,583,93,575,96,568,99,554,102,543,107,527,111,517,116,502,123,492,129,480,136,465,141,450,144,432,145,446,140,458,137,469,132,482,127,497,120,510,113,527,104,504,103,480,103,469,114,453,129,447,137,434,145,440,136,447,128,454,120,460,112,469,101,474,92,476,82,469,74,459,69,448,59,443,51" , // Back Right
            "250,24,234,25,232,42,219,60,208,67,187,67,170,60,157,39,154,24,128,25,119,39,110,46,112,63,125,64,137,64,144,83,127,84,148,93,165,98,195,98,213,100,232,102,242,104,248,107,244,88,244,75,242,56", // Front Right
            "197,431,218,437,230,451,237,476,253,475,245,457,245,433,244,417,248,394,230,395,207,401,193,399,169,404,136,410,128,414,144,418,138,435,114,435,110,448,112,459,120,460,127,475,154,474,157,456,169,440,182,433" , // Front left
            "667,248,666,166,655,163,651,158,643,159,639,163,637,197,610,198,611,303,640,304,637,336,643,342,650,340,655,336,662,334,669,328,669,296,668,276", // Back bumper map
            "18,199,18,171,26,164,32,162,38,157,45,160,48,162,60,163,70,167,69,183,69,209,64,214,64,282,69,289,69,310,69,333,57,336,50,336,42,342,36,338,24,334,19,325,21,260,18,236" // Front Bumper map
        ]
    
        ctx.fillStyle = 'rgba(50, 50, 50, 0.5)'; // Red color with 50% opacity
    
        // Initialize flags
        coordinates.forEach(() => {
            flags.push(false);
        });
    
        // Function to draw the red overlay polygon
        function drawOverlay() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        
            for (let i = 0; i < coordinates.length; i++) {
                if (flags[i]) {
                    const coords = coordinates[i].split(",").map(coord => parseInt(coord, 10));
                    ctx.beginPath();
                    ctx.moveTo(coords[0], coords[1]);
                    for (let j = 2; j < coords.length; j += 2) {
                        ctx.lineTo(coords[j], coords[j + 1]);
                    }
                    ctx.closePath(); // Close the path to complete the polygon
                    ctx.fill();
                }
            }
            // Calculate the total price for active overlays
            let totalPrice = 0;
            flags.forEach((isActive, index) => {
                if (isActive) { 
                    totalPrice += overlayPrices[index];
                    
                }
            });
            const formattedTotalPrice = totalPrice.toFixed(2);
            // Update the displayed total price
            document.getElementById('price').textContent = `${formattedTotalPrice} `;
            document.getElementById('paintPrice').textContent = `${formattedTotalPrice} `;
            document.getElementById('Pricing').value = `${formattedTotalPrice} `;
            calculatePrice()
            }
        
        // Function to toggle the activation of a specific overlay
        window.toggleOverlay = function(index) {
            calculatePrice()
            if (index >= 0 && index < flags.length) {
                flags[index] = !flags[index]; // Toggle the flag
                activeOverlayIndex = flags[index] ? index : -1; // Set activeOverlayIndex
                drawOverlay();
            }
        }
    
        // Function to toggle all overlays
        window.ActivateAllOverlays = function() {
                    for (let i = 0; i < flags.length; i++) {
                        if (i >= 0 && i < flags.length) {
                             flags[i] = true; // Toggle the flag
                             activeOverlayIndex = flags[i] ? i : -1; // Set activeOverlayIndex
                             drawOverlay();
                        }
                    }
                }
            
                // Function to toggle all overlays
        window.DeactivateAllOverlays = function() {
                    for (let i = 0; i < flags.length; i++) {
                        if (i >= 0 && i < flags.length) {
                             flags[i] = false; // Toggle the flag
                             activeOverlayIndex = flags[i] ? i : -1; // Set activeOverlayIndex
                             drawOverlay();
                        }
                    }
                }
        // Initially, all overlays are inactive
        drawOverlay();
    }
    // Store the original image dimensions
    const originalWidth = 707; // Set this to the actual width of your image
    const originalHeight = 500; // Set this to the actual height of your image

    // Get the image and map elements
    const image = document.getElementById('carImage');
    const map = document.getElementById('image-map');

    // Update map coordinates when the window is resized
    function updateMapCoordinates() {
      const newWidth = image.clientWidth;
      const widthRatio = newWidth / originalWidth;
    
      // Update each area tag's coordinates
    
      const areaTags = map.getElementsByTagName('area');
      for (let area of areaTags) {
        const originalCoords = area.getAttribute('coords').split(',');
        const newCoords = originalCoords.map(coord => Math.round(coord * widthRatio)).join(',');
        area.setAttribute('coords', newCoords);
      }
    }

    // Initial map coordinate update
    updateMapCoordinates();

    // Update map coordinates when the window is resized
    window.addEventListener('resize', function(event){
        updateMapCoordinates();
        location.reload(true);
    });

    window.addEventListener('beforeunload', function (event) {
        updateMapCoordinates();
        // Force a full page refresh
        location.reload(true);
    });

    window.addEventListener('load', () => {
        createRedOverlayPolygons();
    });

    function handleAreaMouseOver(index) {
    if (index >= 0 && index < flags.length) {
        const areaElements = document.querySelectorAll('area');
        areaElements.forEach((area, i) => {
            if (i === index) {
                // Apply overlay with lower opacity on hover
                area.style.fill = 'rgba(255, 0, 0, 1)';
            } else {
                area.style.fill = ''; // Reset other areas
            }
        });
    }
}

// Attach mouseover event listener to each area
const areaTags = map.getElementsByTagName('area');
for (let i = 0; i < areaTags.length; i++) {
    areaTags[i].addEventListener('mouseover', function() {
        handleAreaMouseOver(i);
    });
}

// Function to handle mouseout event and reset overlay
function handleAreaMouseOut() {
    const areaElements = document.querySelectorAll('area');
    areaElements.forEach((area) => {
        area.style.fill = ''; // Reset all areas on mouseout
    });
}

// Attach mouseout event listener to each area
for (let i = 0; i < areaTags.length; i++) {
    areaTags[i].addEventListener('mouseout', handleAreaMouseOut);
}
</script>
</body>
</html>



